<div class="transcript">
    <!-- Image container for generated image -->
    <!--<div class="transcript-image-container">
        <div *ngIf="transcript.imageUrl; else noImage">
            <img
                [src]="transcript.imageUrl"
                alt="Loading Image"
                class="transcript-image"
            />
        </div>
        <ng-template #noImage>
            <div class="no-image-placeholder">No Image Selected</div>
        </ng-template>
    </div>-->

    <!-- Image container for uploaded image -->
    <!--<div class="transcript-image-container">
        <div *ngIf="transcript.uploadedImageUrl; else noUploadedImage">
            <img
                [src]="transcript.uploadedImageUrl"
                alt="Uploaded Image"
                class="transcript-image"
            />
        </div>
        <ng-template #noUploadedImage>
            <div class="no-image-placeholder">No Image Selected</div>
        </ng-template>
    </div>-->

    <div class="transcript-card" [class.expanded]="isExpanded">
        <div class="card-section body">
            <!-- <p class="transcript-text" [class.expanded]="isExpanded">{{ transcript.transcript }}</p> -->
            <!-- Display the transcript -->
            <div *ngIf="!isEditing">
                <p class="transcript-text" [class.expanded]="isExpanded">
                    {{ transcript.transcript }}
                </p>
            </div>

            <ng-template #feedbackSection>
                <!-- Loading Indicator -->
                <div *ngIf="isGeneratingFeedback" class="feedback-loading">
                    <div class="spinner"></div>
                    <p>The ChatGPT AI feedback is being generated...</p>
                </div>

                <!-- AI Feedback Display -->
                <div *ngIf="!isGeneratingFeedback && improvementPrompt">
                    <h4>
                        ChatGPT AI Feedback:
                        <span
                            class="feedback-refresh-btn"
                            (click)="onFeedbackRefresh()"
                            title="Refresh Feedback"
                        >
                            <span class="material-icons refresh-icon">
                                autorenew
                            </span>
                        </span>
                    </h4>
                    <p>{{ improvementPrompt }}</p>

                    <!-- Feedback Rating -->
                    <div class="star-rating">
                        <h4>Rate this feedback:</h4>
                        <ng-container
                            *ngFor="let starNumber of [1, 2, 3, 4, 5]"
                        >
                            <span
                                class="star"
                                [class.filled]="
                                    feedbackRatingValue >= starNumber
                                "
                                [class.readonly]="hasRated"
                                (mouseover)="
                                    !hasRated && onStarHover(starNumber)
                                "
                                (mouseleave)="!hasRated && onStarHover(null)"
                                (click)="!hasRated && onStarClick(starNumber)"
                            >
                                <i class="material-icons">
                                    {{ feedbackStarIcon(starNumber) }}
                                </i>
                            </span>
                        </ng-container>
                    </div>
                </div>
            </ng-template>

            <!-- Editable text area -->
            <div *ngIf="isEditing">
                <textarea [(ngModel)]="editedText" rows="6"></textarea>
                <div class="edit-buttons">
                    <button (click)="saveEdit()">Save</button>
                    <button (click)="cancelEdit()">Cancel</button>
                </div>

                <ng-container
                    *ngTemplateOutlet="feedbackSection"
                ></ng-container>
            </div>

            <div *ngIf="isExpanded && !isEditing">
                <ng-container
                    *ngTemplateOutlet="feedbackSection"
                ></ng-container>
            </div>

            <!-- Display the improvement prompt -->
            <!--<div *ngIf="isEditing && improvementPrompt">
                <h4>
                    ChatGPT AI Feedback:

                    <span
                        class="feedback-refresh-btn"
                        (click)="onFeedbackRefresh()"
                        title="Refresh Feedback"
                    >
                        <span class="material-icons refresh-icon">
                            autorenew
                        </span>
                    </span>
                </h4>
                <p>{{ improvementPrompt }}</p>

                <div class="star-rating">
                    <h4>Rate this feedback:</h4>
                    <ng-container *ngFor="let starNumber of [1, 2, 3, 4, 5]">
                        <span
                            class="star"
                            [class.filled]="feedbackRatingValue >= starNumber"
                            [class.readonly]="hasRated"
                            (mouseover)="!hasRated && onStarHover(starNumber)"
                            (mouseleave)="!hasRated && onStarHover(null)"
                            (click)="!hasRated && onStarClick(starNumber)"
                        >
                            <i class="material-icons">
                                {{ feedbackStarIcon(starNumber) }}
                            </i>
                        </span>
                    </ng-container>
                </div>
            </div>-->

            <!-- Display assigned image -->
            <!--<div *ngIf="isExpanded && transcript.imageUrl && !isEditing">
                <img
                    [src]="transcript.imageUrl"
                    alt="Assigned image"
                    class="transcript-image"
                />
            </div>-->

            <!--<div
                *ngIf="
                    isExpanded &&
                    transcript.imageUrl == '' &&
                    imageUrls.length > 0
                "
            >
                <h4>Select an Image:</h4>
                <div class="image-selection" *ngIf="imageUrls.length > 0">
                    <div class="image-list">
                        <img
                            *ngFor="let url of imageUrls"
                            [src]="url"
                            alt="Generated image"
                            class="transcript-image"
                            (click)="storeImage(url)"
                        />
                    </div>
                </div>
            </div>-->
        </div>
        <div class="card-section footer">
            <div class="transcript-details">
                <p class="transcript-date">
                    {{ transcript.creation_date.toDate() | date : "MMM d, y" }}
                </p>
                <p class="transcript-topic">{{ transcript.topic }}</p>
            </div>
            <div class="collapse-card" (click)="toggleExpand()">
                <span class="material-icons">
                    {{ isExpanded ? "expand_less" : "expand_more" }}
                </span>
            </div>
            <div class="transcript-icons">
                <!-- Story Review Edit Icon -->
                <span
                    class="material-icons"
                    title="Edit story"
                    [ngClass]="{ 'active-icon': transcript.edited }"
                    [class.icon-hidden]="transcript.show_to_teacher"
                    (click)="toggleEdit()"
                >
                    edit
                </span>

                <!-- Delete Icon -->
                <span
                    class="material-icons"
                    title="Delete story"
                    [class.icon-hidden]="transcript.show_to_teacher"
                    (click)="deleteStory()"
                >
                    delete
                </span>

                <!-- Select Uploaded Image Icon -->
                <!--<div class="image-btn">
                    <span
                        class="material-icons"
                        [ngStyle]="{
                            color: transcript.uploadedImageUrl
                                ? '#90d600'
                                : 'inherit'
                        }"
                        (click)="onOpenImageModal()"
                    >
                        image_search
                    </span>
                </div>-->

                <!-- Generate Image Icon -->
                <!--<div class="image-btn">
                    <span
                        class="material-icons"
                        [ngStyle]="{
                            color: transcript.imageUrl ? '#90d600' : 'inherit'
                        }"
                        (click)="generateImages()"
                    >
                        image
                    </span>
                </div>-->

                <!-- Send to Teacher Icon -->
                <span
                    class="material-icons"
                    [title]="
                        transcript.show_to_teacher
                            ? 'Sent to teacher'
                            : 'Send to teacher'
                    "
                    [ngClass]="{ 'active-icon': transcript.show_to_teacher }"
                    (click)="sendToTeacher()"
                >
                    send
                </span>
            </div>
        </div>
    </div>
</div>
