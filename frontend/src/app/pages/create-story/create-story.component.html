<div class="create-story-container">
    <h1 class="page-title">Record A Story</h1>

    <!-- Current topic and prompt -->
    <div class="classroom-info">
        <ng-container *ngIf="selectedTopic && capturePrompt">
            <div class="topic-text">
                <strong>Current Topic:</strong> {{ selectedTopic }}
            </div>
            <div class="prompt-text">
                <strong>Prompt:</strong> {{ capturePrompt }}
            </div>
        </ng-container>
        <ng-container *ngIf="selectedTopic && !capturePrompt">
            <div class="topic-text">
                <strong>Topic:</strong> {{ selectedTopic }}
            </div>
        </ng-container>
    </div>

    <!-- Audio Recording -->
    <div class="audio-recorder" *ngIf="!isReviewing">
        <button
            *ngIf="!isProcessing"
            class="record-btn"
            (click)="toggleRecording()"
            [attr.aria-label]="
                isRecording ? 'Stop recording' : 'Start recording'
            "
            type="button"
        >
            <ng-container *ngIf="!isRecording">
                <i class="material-icons mic-icon">mic</i>
            </ng-container>
            <ng-container *ngIf="isRecording">
                <i class="material-icons stop-icon">stop</i>
            </ng-container>
        </button>
        <span class="recording-status" *ngIf="isRecording">Recording...</span>

        <div class="processing-indicator" *ngIf="isProcessing">
            <div class="spinner"></div>
            <span class="processing-text">Processing your recording...</span>
        </div>
    </div>

    <!-- Audio Review -->
    <div class="audio-review" *ngIf="isReviewing">
        <p class="review-prompt">Listen to your recording:</p>
        <audio [src]="recordedAudioUrl" controls class="audio-player"></audio>
        <div class="review-buttons">
            <button class="confirm-btn" (click)="submitRecording()">
                Submit
            </button>
            <button class="cancel-btn" (click)="cancelRecording()">
                Cancel
            </button>
        </div>
    </div>

    <ng-container *ngIf="!isReviewing && !isProcessing">
        <p class="separator">OR</p>

        <!-- Story Text Box -->
        <div class="story-entry">
            <textarea
                [(ngModel)]="story"
                placeholder="Write your story here..."
                rows="4"
                class="story-textarea"
                (input)="onStoryInput()"
            ></textarea>
            <button class="confirm-btn" (click)="confirmSubmitStory()">
                Submit
            </button>
        </div>
    </ng-container>

    <div class="back-btn-container">
        <button class="back-btn" (click)="onBackClick()">Back</button>
    </div>
</div>
